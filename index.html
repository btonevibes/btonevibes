<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rawls' Original Position Game - Pairwise Choice</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Light blue-gray background */
        }
        .country-card {
            background-color: white;
            border-radius: 0.75rem; /* Rounded corners */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            width: 100%; /* Full width on small screens */
        }
        .country-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .stat-bar-container {
            display: flex; /* Enables flex properties for aligning bars */
            align-items: flex-end; /* Aligns bars to the bottom of the container */
            height: 22px; /* Consistent height for the container */
            gap: 3px; /* Space between individual bar segments */
            /* Fixed width is now applied via Tailwind: w-[75px] */
            /* justify-content is now applied via Tailwind: justify-start */
        }
        .stat-bar {
            width: 8px; /* Width of each bar segment */
            border-radius: 2px; /* Slightly rounded bars */
            /* Height is set inline in JS: 18px */
        }
        .action-button {
            background-color: #3B82F6;
            color: white;
            font-weight: 600;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background-color 0.2s;
            border: none;
            outline: none;
        }
        .action-button:hover {
            background-color: #2563EB;
        }
        #resultsArea ol li {
            background-color: #fff;
            padding: 0.75rem 1rem;
            border-radius: 0.375rem;
            box-shadow: 0 1px 3px 0 rgba(0,0,0,0.1), 0 1px 2px 0 rgba(0,0,0,0.06);
            margin-bottom: 0.5rem;
        }
        #resultsArea ol li .rank-badge {
            display: inline-block;
            width: 2rem;
            height: 2rem;
            line-height: 2rem;
            text-align: center;
            border-radius: 50%;
            background-color: #3B82F6;
            color: white;
            font-weight: bold;
            margin-right: 0.75rem;
        }
    </style>
</head>
<body class="text-gray-800 antialiased">

    <div class="container mx-auto px-4 py-8">
        <header class="text-center mb-6">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-700 mb-3">The Original Position</h1>
            <p id="gameInstructions" class="text-md md:text-lg text-gray-600 max-w-3xl mx-auto">
                You are a human embryo in space, about to land on Earth. Behind the 'Veil of Ignorance,' you don't know your future circumstances.
                You will be presented with <strong class="font-semibold">pairs of fictional countries</strong>. For each pair, choose the country you would prefer to be born into based <strong class="font-semibold">only</strong> on these societal statistics. Your choices will help rank your preferences.
            </p>
        </header>

        <div id="gameArea">
            <div id="progressArea" class="text-center my-4 text-lg font-medium text-gray-600">
                </div>
            <div id="comparisonArea" class="flex flex-col md:flex-row justify-around items-stretch gap-6 md:gap-8 mb-8">
                <div id="countryCardA" class="country-card p-6 flex flex-col justify-between"></div>
                <div id="countryCardB" class="country-card p-6 flex flex-col justify-between"></div>
            </div>
        </div>

        <div id="resultsArea" class="hidden mt-10">
            <h2 class="text-3xl font-bold mb-6 text-center text-gray-700">Your Country Preferences</h2>
            <ol id="rankedList" class="max-w-lg mx-auto space-y-2">
                </ol>
            <button id="playAgainBtn" class="action-button block mx-auto mt-8">Play Again</button>
        </div>

        <footer class="mt-12 pt-8 border-t border-gray-300 text-sm text-gray-500">
            <p class="mb-1"><strong>Data Sources:</strong></p>
            <ul class="list-disc list-inside">
                <li>Life Expectancy, Homicide Rate, Infant Mortality Rate: <a href="https://www.who.int/data/gho" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline">World Health Organization (WHO) GHO data</a>.</li>
                <li>Median Disposable Income, Poverty Rate, Foreign-Born Population: OECD data.</li>
            </ul>
        </footer>
    </div>

    <script>
        // --- DATA ---
        // Updated with the precise dataset provided by the user.
        const countriesData = [
            { fictionalName: "AETHELGARD", realName: "Australia",       stats: { lifeExpectancy: 83.2, povertyRate: 12.3, homicideRate: 0.9, infantMortality: 3.3,  foreignBorn: 29.3, medianIncome: 36835 }},
            { fictionalName: "BORELIA",    realName: "Canada",          stats: { lifeExpectancy: 81.3, povertyRate: 11.2, homicideRate: 2.1, infantMortality: 4.4,  foreignBorn: 23.0, medianIncome: 39388 }},
            { fictionalName: "CASPIA",     realName: "Denmark",         stats: { lifeExpectancy: 81.3, povertyRate: 5.6,  homicideRate: 1.0, infantMortality: 3.1,  foreignBorn: 14.0, medianIncome: 34061 }},
            { fictionalName: "DRAKON",     realName: "France",          stats: { lifeExpectancy: 82.2, povertyRate: 8.4,  homicideRate: 1.3, infantMortality: 3.2,  foreignBorn: 10.3, medianIncome: 30622 }},
            { fictionalName: "ELARA",      realName: "Germany",         stats: { lifeExpectancy: 80.7, povertyRate: 9.8,  homicideRate: 0.8, infantMortality: 3.2,  foreignBorn: 17.3, medianIncome: 35537 }},
            { fictionalName: "FAELAN",     realName: "Netherlands",     stats: { lifeExpectancy: 81.7, povertyRate: 7.5,  homicideRate: 0.7, infantMortality: 3.4,  foreignBorn: 14.0, medianIncome: 35891 }},
            { fictionalName: "GWYN",       realName: "Sweden",          stats: { lifeExpectancy: 83.1, povertyRate: 6.8,  homicideRate: 1.2, infantMortality: 1.9,  foreignBorn: 19.8, medianIncome: 33472 }},
            { fictionalName: "HYPERIA",    realName: "Switzerland",     stats: { lifeExpectancy: 83.8, povertyRate: 10.4, homicideRate: 0.6, infantMortality: 3.5,  foreignBorn: 30.0, medianIncome: 39698 }},
            { fictionalName: "IRIDIA",     realName: "United Kingdom",  stats: { lifeExpectancy: 80.8, povertyRate: 11.7, homicideRate: 1.1, infantMortality: 4.0,  foreignBorn: 16.8, medianIncome: 26884 }},
            { fictionalName: "JORIN",      realName: "United States",   stats: { lifeExpectancy: 76.9, povertyRate: 18.0, homicideRate: 5.8, infantMortality: 5.4,  foreignBorn: 14.0, medianIncome: 48625 }}
        ];

        // --- GAME STATE ---
        let countryScores = {};
        let currentComparisonCount = 0;
        // With 10 countries, max unique pairs = (10*9)/2 = 45.
        // 15 comparisons will give a good sense of preference without being too long.
        const TOTAL_COMPARISONS = 15;
        let currentPairIndices = [];

        // --- DOM ELEMENTS ---
        const gameArea = document.getElementById('gameArea');
        const resultsArea = document.getElementById('resultsArea');
        const countryCardA_div = document.getElementById('countryCardA');
        const countryCardB_div = document.getElementById('countryCardB');
        const progressArea = document.getElementById('progressArea');
        const rankedList_ol = document.getElementById('rankedList');
        const playAgainBtn = document.getElementById('playAgainBtn');

        // --- UTILITY FUNCTIONS (BARS) ---
        function getBarRating(value, statKey, isPositiveGood) {
            const allValues = countriesData
                .map(c => c.stats[statKey])
                .filter(v => typeof v === 'number' && !isNaN(v));
            if (allValues.length === 0) {
                return { barCount: 3, colorClass: 'bg-yellow-400' }; // Default if no data
            }
            const minVal = Math.min(...allValues);
            const maxVal = Math.max(...allValues);
            let barCount;
            let colorClass;
            if (minVal === maxVal) { // All values are the same
                barCount = 3;
                colorClass = 'bg-yellow-400';
            } else {
                let normalizedValue;
                if (isPositiveGood) { // Higher is better
                    normalizedValue = (value - minVal) / (maxVal - minVal);
                } else { // Lower is better
                    normalizedValue = (maxVal - value) / (maxVal - minVal);
                }
                // Scale normalizedValue (0 to 1) to bar count (1 to 6)
                barCount = Math.round(1 + normalizedValue * 5);
                barCount = Math.max(1, Math.min(6, barCount)); // Ensure barCount is between 1 and 6

                // Determine color based on the calculated barCount
                if (barCount >= 5) { // 5 or 6 bars
                    colorClass = 'bg-green-500';
                } else if (barCount >= 3) { // 3 or 4 bars
                    colorClass = 'bg-yellow-400';
                } else { // 1 or 2 bars
                    colorClass = 'bg-red-500';
                }
            }
            return { barCount, colorClass };
        }

        function generateBarsHTML(barCount, colorClass) {
            // Added w-[75px] for fixed width and justify-start to align bar groups.
            let barsHTML = '<div class="stat-bar-container w-[75px] justify-start">';
            for (let i = 0; i < barCount; i++) {
                barsHTML += `<div class="stat-bar ${colorClass}" style="height: 18px;"></div>`;
            }
            barsHTML += '</div>';
            return barsHTML;
        }

        // --- COUNTRY CARD RENDERING ---
        function createCountryCardHTML(country, countryIndex) {
            const leRating = getBarRating(country.stats.lifeExpectancy, 'lifeExpectancy', true);
            const incomeRating = getBarRating(country.stats.medianIncome, 'medianIncome', true);
            const povertyRating = getBarRating(country.stats.povertyRate, 'povertyRate', false);
            const homicideRating = getBarRating(country.stats.homicideRate, 'homicideRate', false);
            const imRating = getBarRating(country.stats.infantMortality, 'infantMortality', false);

            return `
                <div> <h2 class="text-2xl font-bold uppercase text-blue-600 mb-4 text-center">${country.fictionalName}</h2>
                    <div class="space-y-3 text-sm text-gray-700">
                        <div class="flex justify-between items-center"><span>Life Expectancy: ${country.stats.lifeExpectancy.toFixed(1)} yrs</span>${generateBarsHTML(leRating.barCount, leRating.colorClass)}</div>
                        <div class="flex justify-between items-center"><span>Median Income: $${country.stats.medianIncome.toLocaleString()}</span>${generateBarsHTML(incomeRating.barCount, incomeRating.colorClass)}</div>
                        <div class="flex justify-between items-center"><span>Poverty Rate: ${country.stats.povertyRate.toFixed(1)}%</span>${generateBarsHTML(povertyRating.barCount, povertyRating.colorClass)}</div>
                        <div class="flex justify-between items-center"><span>Homicide Rate: ${country.stats.homicideRate.toFixed(1)} /100k</span>${generateBarsHTML(homicideRating.barCount, homicideRating.colorClass)}</div>
                        <div class="flex justify-between items-center"><span>Infant Mortality: ${country.stats.infantMortality.toFixed(1)} /1k</span>${generateBarsHTML(imRating.barCount, imRating.colorClass)}</div>
                        <div class="flex justify-between items-center"><span>Foreign-Born: ${country.stats.foreignBorn.toFixed(1)}%</span><div class="stat-bar-container w-[75px] justify-start"></div></div>
                    </div>
                </div>
                <button class="action-button w-full mt-6 select-country-btn" data-country-index="${countryIndex}">
                    Choose ${country.fictionalName}
                </button>
            `;
        }

        // --- GAME LOGIC ---
        function startGame() {
            // Initialize scores for the current set of countries
            countryScores = {};
            countriesData.forEach(country => {
                countryScores[country.realName] = 0;
            });
            currentComparisonCount = 0;
            resultsArea.classList.add('hidden');
            gameArea.classList.remove('hidden');
            progressArea.textContent = ''; // Clear progress text initially
            nextComparison();
        }

        function nextComparison() {
            // Check if there are enough countries to form a pair
            if (countriesData.length < 2) {
                progressArea.textContent = "Not enough countries to continue comparisons.";
                showResults(); // Show results even if comparisons didn't complete, or handle differently
                return;
            }

            currentComparisonCount++;
            if (currentComparisonCount > TOTAL_COMPARISONS) {
                showResults();
                return;
            }
            progressArea.textContent = `Comparison ${currentComparisonCount} of ${TOTAL_COMPARISONS}`;

            // Select two different random countries from the current list
            let index1 = Math.floor(Math.random() * countriesData.length);
            let index2 = Math.floor(Math.random() * countriesData.length);
            while (index1 === index2) { // Ensure they are different countries
                index2 = Math.floor(Math.random() * countriesData.length);
            }
            currentPairIndices = [index1, index2];

            const countryA = countriesData[index1];
            const countryB = countriesData[index2];

            // Pass the direct indices (0 to countriesData.length-1) to createCountryCardHTML
            countryCardA_div.innerHTML = createCountryCardHTML(countryA, index1);
            countryCardB_div.innerHTML = createCountryCardHTML(countryB, index2);

            // Re-attach event listeners to the new buttons
            document.querySelectorAll('.select-country-btn').forEach(button => {
                button.replaceWith(button.cloneNode(true));
            });
            document.querySelectorAll('.select-country-btn').forEach(button => {
                 button.addEventListener('click', handleChoice);
            });
        }

        function handleChoice(event) {
            // The data-country-index now directly corresponds to the index in the current countriesData array
            const chosenCountryIndex = parseInt(event.target.dataset.countryIndex);
            const chosenCountryRealName = countriesData[chosenCountryIndex].realName;
            countryScores[chosenCountryRealName]++;
            nextComparison();
        }

        function showResults() {
            gameArea.classList.add('hidden');
            resultsArea.classList.remove('hidden');
            if (currentComparisonCount <= TOTAL_COMPARISONS && countriesData.length >=2 ) {
                 progressArea.textContent = "Comparisons Complete!";
            } else if (countriesData.length < 2) {
                 progressArea.textContent = "Not enough countries for further comparison. Showing current results.";
            }

            const sortedCountries = Object.entries(countryScores)
                .map(([realName, score]) => ({ realName, score }))
                .sort((a, b) => b.score - a.score);
            rankedList_ol.innerHTML = '';
            sortedCountries.forEach((country, index) => {
                const listItem = document.createElement('li');
                listItem.className = "flex items-center";
                listItem.innerHTML = `
                    <span class="rank-badge">${index + 1}</span>
                    <span>${country.realName} - Chosen: ${country.score} time(s)</span>
                `;
                rankedList_ol.appendChild(listItem);
            });
        }

        // --- EVENT LISTENERS ---
        playAgainBtn.addEventListener('click', startGame);

        // --- INITIALIZE GAME ---
        startGame();
    </script>
</body>
</html>
